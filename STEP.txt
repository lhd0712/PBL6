/PBL_RTFM_From_Scratch/
|
|-- UCF_Crimes_Videos/    (Chá»©a táº¥t cáº£ video .mp4)
|   |-- Abuse/
|   |-- Normal_Videos/
|   |-- ...
|
|-- I3D_Features/         (Ban Ä‘áº§u trá»‘ng, Giai Ä‘oáº¡n 1 sáº½ Ä‘iá»n vÃ o Ä‘Ã¢y)
|   |-- Abuse/
|   |-- Normal_Videos/
|   |-- ...
|
|-- Ground_Truth_Files/
|   |-- Anomaly_Train.txt
|   |-- Temporal_Anomaly_Annotation.txt
|
|-- extract_features.py   (Script cho Giai Ä‘oáº¡n 1)
|-- create_lists.py       (Script cho Giai Ä‘oáº¡n 2)
|-- rtfm_model.py         (Script cho Giai Ä‘oáº¡n 3)
|-- rtfm_loss.py          (Script cho Giai Ä‘oáº¡n 3)
|-- rtfm_dataset.py       (Script cho Giai Ä‘oáº¡n 4)
|-- train_stage_1.py      (Script cho Giai Ä‘oáº¡n 4)
|-- train_stage_2.py      (Script cho Giai Ä‘oáº¡n 5)
|-- evaluate.py           (Script cho Giai Ä‘oáº¡n 6)

- Giai Ä‘oáº¡n 1: âš™ï¸ TrÃ­ch xuáº¥t Äáº·c trÆ°ng (Dá»± Ã¡n 1)
ÄÃ¢y lÃ  giai Ä‘oáº¡n tiá»n xá»­ lÃ½, biáº¿n video thÃ´ thÃ nh dá»¯ liá»‡u.
!!! CODE DEMO khÃ´ng pháº£i CODE THáº¬T !!!
extract_features.py:
Má»¥c tiÃªu: "Code ra" cÃ¡c tá»‡p Ä‘áº·c trÆ°ng .npy (I3D).
Äáº§u vÃ o: CÃ¡c video .mp4 trong thÆ° má»¥c UCF_Crimes_Videos.
Äáº§u ra: CÃ¡c tá»‡p .npy (Ä‘áº·c trÆ°ng I3D) Ä‘Æ°á»£c lÆ°u vÃ o thÆ° má»¥c I3D_Features.
CÃ´ng viá»‡c: Táº£i mÃ´ hÃ¬nh I3D tá»« pytorchvideo, Ä‘á»c tá»«ng video, cáº¯t thÃ nh clip 16-frame, Ä‘áº©y qua mÃ´ hÃ¬nh I3D, vÃ  lÆ°u cÃ¡c vector Ä‘áº·c trÆ°ng (2048 chiá»u) vÃ o tá»‡p .npy. ÄÃ¢y lÃ  bÆ°á»›c náº·ng vÃ  tá»‘n thá»i gian nháº¥t.

- Giai Ä‘oáº¡n 2: ğŸ—‚ï¸ Chuáº©n bá»‹ Danh sÃ¡ch
Giai Ä‘oáº¡n nÃ y chuáº©n bá»‹ cÃ¡c tá»‡p "chá»‰ má»¥c" Ä‘á»ƒ huáº¥n luyá»‡n vÃ  kiá»ƒm thá»­.

create_lists.py:
Má»¥c tiÃªu: "Code ra" cÃ¡c tá»‡p rtfm_train.list vÃ  rtfm_test.list.
Äáº§u vÃ o: CÃ¡c tá»‡p .npy (tá»« Giai Ä‘oáº¡n 1) vÃ  cÃ¡c tá»‡p Ground Truth (vÃ­ dá»¥: Anomaly_Train.txt).
Äáº§u ra: Hai tá»‡p vÄƒn báº£n (.list) trong thÆ° má»¥c feature_lists.
CÃ´ng viá»‡c: NÃ³ quÃ©t cÃ¡c tá»‡p .npy báº¡n vá»«a táº¡o vÃ  Ä‘á»‘i chiáº¿u vá»›i tá»‡p Anomaly_Train.txt Ä‘á»ƒ táº¡o ra má»™t danh sÃ¡ch "tá»•ng" (master list) cho viá»‡c huáº¥n luyá»‡n, gÃ¡n nhÃ£n 0 (Normal) hoáº·c 1 (Anomaly) cho má»—i tá»‡p .npy.

- Giai Ä‘oáº¡n 3: âœï¸ "Code ra" LÃµi cá»§a RTFM
ÄÃ¢y lÃ  cÃ¡c "thÆ° viá»‡n" chá»©a logic cá»‘t lÃµi cá»§a bÃ i bÃ¡o RTFM. ChÃºng khÃ´ng tá»± cháº¡y mÃ  Ä‘Æ°á»£c cÃ¡c tá»‡p khÃ¡c import.

rtfm_model.py:
Má»¥c tiÃªu: Äá»‹nh nghÄ©a kiáº¿n trÃºc cá»§a 2 mÃ´ hÃ¬nh máº¡ng.
Ná»™i dung: Chá»©a class RTFM_TFM (mÃ´ hÃ¬nh chÃ­nh dÃ¹ng TConv nn.Conv1d) vÃ  class Classifier (mÃ´ hÃ¬nh MLP phá»¥ dÃ¹ng nn.Linear, giá»‘ng cá»§a Sultani).

rtfm_loss.py:
Má»¥c tiÃªu: Äá»‹nh nghÄ©a hÃ m loss "ma thuáº­t" cá»§a RTFM.
Ná»™i dung: Chá»©a hÃ m rtfm_loss_fn tÃ­nh toÃ¡n 3 thÃ nh pháº§n: Ranking Loss (Ä‘áº©y Ä‘á»™ lá»›n normal > abnormal), Sparsity Loss, vÃ  Smoothness Loss.

rtfm_dataset.py:
Má»¥c tiÃªu: Äá»‹nh nghÄ©a cÃ¡ch táº£i dá»¯ liá»‡u cho PyTorch.
Ná»™i dung: Chá»©a class RTFMDataset (Ä‘á»ƒ Ä‘á»c tá»‡p .npy vÃ  xá»­ lÃ½ 32-snippet) vÃ  class BalancedSampler (quan trá»ng, Ä‘á»ƒ Ä‘áº£m báº£o má»—i batch huáº¥n luyá»‡n Giai Ä‘oáº¡n 1 cÃ³ 50% Normal vÃ  50% Abnormal).

Giai Ä‘oáº¡n 4-6: ğŸ‹ï¸ğŸ Huáº¥n luyá»‡n vÃ  ÄÃ¡nh giÃ¡ (Dá»± Ã¡n 2)
ÄÃ¢y lÃ  cÃ¡c ká»‹ch báº£n (scripts) chÃ­nh mÃ  báº¡n sáº½ cháº¡y Ä‘á»ƒ huáº¥n luyá»‡n vÃ  kiá»ƒm thá»­.

train_stage_1.py:
Má»¥c tiÃªu: Ká»‹ch báº£n huáº¥n luyá»‡n Giai Ä‘oáº¡n 1 (huáº¥n luyá»‡n TFM).
CÃ¡ch cháº¡y: python train_stage_1.py.
CÃ´ng viá»‡c: Táº£i RTFM_TFM (tá»« rtfm_model.py), rtfm_loss_fn (tá»« rtfm_loss.py) vÃ  BalancedSampler (tá»« rtfm_dataset.py). NÃ³ huáº¥n luyá»‡n mÃ´ hÃ¬nh TFM vÃ  lÆ°u checkpoint rtfm_tfm_model.pth.

train_stage_2.py:
Má»¥c tiÃªu: Ká»‹ch báº£n huáº¥n luyá»‡n Giai Ä‘oáº¡n 2 (huáº¥n luyá»‡n Classifier).
CÃ¡ch cháº¡y: python train_stage_2.py.
CÃ´ng viá»‡c: Táº£i checkpoint rtfm_tfm_model.pth (vÃ  Ä‘Ã³ng bÄƒng nÃ³), táº£i Classifier (tá»« rtfm_model.py). NÃ³ dÃ¹ng BCELoss thÃ´ng thÆ°á»ng Ä‘á»ƒ huáº¥n luyá»‡n chá»‰ Classifier. Káº¿t quáº£ lÃ  checkpoint rtfm_classifier_model.pth.

evaluate.ipynb:
Má»¥c tiÃªu: Ká»‹ch báº£n cuá»‘i cÃ¹ng Ä‘á»ƒ Ä‘Ã¡nh giÃ¡ PBL cá»§a báº¡n.
CÃ´ng viá»‡c: Táº£i cáº£ hai checkpoint (.pth). Cháº¡y táº¥t cáº£ video test qua cáº£ hai mÃ´ hÃ¬nh. So sÃ¡nh káº¿t quáº£ dá»± Ä‘oÃ¡n (Ä‘Ã£ upsample) vá»›i Temporal_Anomaly_Annotation.txt vÃ  in ra Ä‘iá»ƒm ROC AUC cuá»‘i cÃ¹ng.

I. tao moi truong
    python -m venv venv
    .\venv\Scripts\activate
    pip install torch torchvision
    pip install numpy opencv-python scikit-learn matplotlib
    pip install pytorchvideo